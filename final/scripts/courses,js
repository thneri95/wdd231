// This script handles fetching and displaying course data.

// URL for your JSON data
const coursesApiUrl = 'https://thneri95.github.io/wdd231/final/Json/courses.json';
let allCourses = []; // To store all fetched courses

/**
 * Fetches course data from the API.
 */
async function fetchCourses() {
    try {
        const response = await fetch(coursesApiUrl);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        allCourses = data; // Store the fetched data
        renderCourses(allCourses); // Display all courses initially
    } catch (error) {
        console.error("Error fetching courses:", error);
        document.getElementById('course-container').innerHTML = '<p>Sorry, we could not load the courses at this time.</p>';
    }
}

/**
 * Renders an array of course objects into the DOM.
 * @param {Array} courses - The array of courses to display.
 */
function renderCourses(courses) {
    const container = document.getElementById('course-container');
    container.innerHTML = ''; // Clear previous content

    if (courses.length === 0) {
        container.innerHTML = '<p>No courses match the selected filter.</p>';
        return;
    }

    courses.forEach(course => {
        const card = document.createElement('div');
        card.className = 'course-card';
        card.innerHTML = `
            <img src="${course.image}" alt="${course.title}" loading="lazy">
            <div class="card-content">
                <h3>${course.title}</h3>
                <p class="level">${course.level}</p>
                <p>${course.description}</p>
                <button class="details-btn">View Details</button>
            </div>
        `;
        // Add event listener to the button to open the modal
        card.querySelector('.details-btn').addEventListener('click', () => openModal(course));
        container.appendChild(card);
    });
}

/**
 * Opens the modal with details for a specific course.
 * @param {Object} course - The course object to display.
 */
function openModal(course) {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    modalBody.innerHTML = `
        <h2 id="modal-title">${course.title}</h2>
        <p><strong>Level:</strong> ${course.level}</p>
        <p><strong>Duration:</strong> ${course.duration}</p>
        <p><strong>Price:</strong> $${course.price}</p>
        <h4>What you'll learn:</h4>
        <ul>
            ${course.learnings.map(item => `<li>${item}</li>`).join('')}
        </ul>
    `;

    modal.setAttribute('aria-hidden', 'false');
    modal.style.display = 'flex'; // Show the modal
}

/**
 * Sets up the event listener for the course filter dropdown.
 */
function handleFilter() {
    const filterSelect = document.getElementById('level-filter');
    filterSelect.addEventListener('change', (event) => {
        const selectedLevel = event.target.value;
        if (selectedLevel === 'all') {
            renderCourses(allCourses);
        } else {
            const filteredCourses = allCourses.filter(course => course.level.toLowerCase() === selectedLevel);
            renderCourses(filteredCourses);
        }
    });
}

/**
 * Sets up the event listener for closing the modal.
 */
function handleModalClose() {
    const modal = document.getElementById('modal');
    const closeButton = document.getElementById('modal-close');

    closeButton.addEventListener('click', () => {
        modal.setAttribute('aria-hidden', 'true');
        modal.style.display = 'none'; // Hide the modal
    });

    // Close modal if clicking outside the content
    modal.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.setAttribute('aria-hidden', 'true');
            modal.style.display = 'none';
        }
    });
}

// Initialize all functionality when the page loads
document.addEventListener('DOMContentLoaded', () => {
    fetchCourses();
    handleFilter();
    handleModalClose();
});
