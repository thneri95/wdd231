// This script handles fetching and displaying course data dynamically on the courses.html page.

const coursesApiUrl = 'https://thneri95.github.io/wdd231/final/Json/courses.json';
let allCourses = []; // To store all fetched courses

/**
 * Fetches course data from the API and stores it globally.
 */
async function fetchCourses() {
    try {
        const response = await fetch(coursesApiUrl);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        allCourses = data;
        renderCourses(allCourses);
    } catch (error) {
        console.error("Error fetching courses:", error);
        document.getElementById('course-container').innerHTML = '<p>Sorry, we could not load the courses at this time.</p>';
    }
}

/**
 * Renders course cards to the DOM.
 * @param {Array} courses - The array of courses to render.
 */
function renderCourses(courses) {
    const container = document.getElementById('course-container');
    container.innerHTML = '';

    if (courses.length === 0) {
        container.innerHTML = '<p>No courses found for the selected level.</p>';
        return;
    }

    courses.forEach(course => {
        const card = document.createElement('div');
        card.className = 'course-card';

        card.innerHTML = `
            <img src="images/courses/${course.id}.jpg" alt="${course.title}" loading="lazy">
            <div class="card-content">
                <h3>${course.title}</h3>
                <p class="level">Level: ${course.level}</p>
                <p>${course.description}</p>
                <button class="details-btn">View Details</button>
            </div>
        `;

        card.querySelector('.details-btn').addEventListener('click', () => openModal(course));
        container.appendChild(card);
    });
}

/**
 * Opens a modal showing the full course details.
 * @param {Object} course - The course object to display.
 */
function openModal(course) {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modal-body');

    modalBody.innerHTML = `
        <h2 id="modal-title">${course.title}</h2>
        <p><strong>Level:</strong> ${course.level}</p>
        <p><strong>Duration:</strong> ${course.duration}</p>
        <p><strong>Price:</strong> ${course.price}</p>
        <h4>What you'll learn:</h4>
        <ul>
            ${course.syllabus.map(topic => `<li>${topic}</li>`).join('')}
        </ul>
    `;

    modal.setAttribute('aria-hidden', 'false');
    modal.style.display = 'flex';
}

/**
 * Enables filtering courses by level.
 */
function handleFilter() {
    const filterSelect = document.getElementById('level-filter');
    filterSelect.addEventListener('change', (event) => {
        const selected = event.target.value.toLowerCase();
        if (selected === 'all') {
            renderCourses(allCourses);
        } else {
            const filtered = allCourses.filter(course => course.level.toLowerCase() === selected);
            renderCourses(filtered);
        }
    });
}

/**
 * Adds close functionality to the modal.
 */
function handleModalClose() {
    const modal = document.getElementById('modal');
    const closeButton = document.getElementById('modal-close');

    closeButton.addEventListener('click', () => {
        modal.setAttribute('aria-hidden', 'true');
        modal.style.display = 'none';
    });

    modal.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.setAttribute('aria-hidden', 'true');
            modal.style.display = 'none';
        }
    });
}

// Initialize when the page loads
document.addEventListener('DOMContentLoaded', () => {
    fetchCourses();
    handleFilter();
    handleModalClose();
});
